import{H3Event as i,setResponseStatus as g,appendResponseHeader as y,sendRedirect as h,setHeader as l,getRequestIP as m,getResponseStatus as b,getResponseStatusText as H,getCookie as S,setCookie as x,getRequestURL as q,getResponseHeaders as A,getResponseHeader as v,setResponseHeader as C,removeResponseHeader as T,getRequestWebStream as E}from"h3";import{getContext as $}from"unctx";import{AsyncLocalStorage as k}from"node:async_hooks";function w(e){let t;const s=f(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(s,{...r,body:e.node.req.body}):new Request(s,{...r,get body(){return t||(t=F(e),t)}})}function _(e){return e.web??={request:w(e),url:f(e)},e.web.request}function P(){return B()}const d=Symbol("$HTTPEvent");function W(e){return typeof e=="object"&&(e instanceof i||e?.[d]instanceof i||e?.__is_event__===!0)}function n(e){return function(...t){let s=t[0];if(W(s))t[0]=s instanceof i||s.__is_event__?s:s[d];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(s=P(),!s)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(s)}return e(...t)}}const f=n(q),j=n(m),u=n(g),c=n(b),L=n(H),o=n(A),p=n(v),O=n(C),R=n(y),Q=n(h),V=n(S),X=n(x),Y=n(l),F=n(E),U=n(T),I=n(_);function N(){return $("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:k})}function B(){return N().use().event}const a="solidFetchEvent";function M(e){return{request:I(e),response:D(e),clientAddress:j(e),locals:{},nativeEvent:e}}function Z(e){return{...e}}function ee(e){if(!e.context[a]){const t=M(e);e.context[a]=t}return e.context[a]}function te(e,t){for(const[s,r]of t.entries())R(e,s,r)}class z{event;constructor(t){this.event=t}get(t){const s=p(this.event,t);return Array.isArray(s)?s.join(", "):s||null}has(t){return this.get(t)!==void 0}set(t,s){return O(this.event,t,s)}delete(t){return U(this.event,t)}append(t,s){R(this.event,t,s)}getSetCookie(){const t=p(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries(o(this.event)).forEach(([s,r])=>t(Array.isArray(r)?r.join(", "):r,s,this))}entries(){return Object.entries(o(this.event)).map(([t,s])=>[t,Array.isArray(s)?s.join(", "):s])[Symbol.iterator]()}keys(){return Object.keys(o(this.event))[Symbol.iterator]()}values(){return Object.values(o(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function D(e){return{get status(){return c(e)},set status(t){u(e,t)},get statusText(){return L(e)},set statusText(t){u(e,c(e),t)},headers:new z(e)}}export{ee as a,u as b,Y as c,Z as d,Q as e,V as g,te as m,X as s};
