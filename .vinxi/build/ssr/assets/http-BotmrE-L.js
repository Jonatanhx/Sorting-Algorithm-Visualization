import{H3Event as o,setResponseStatus as i,sendRedirect as c,setHeader as p,getRequestIP as R,getResponseStatus as d,getResponseStatusText as g,getCookie as f,setCookie as H,getRequestURL as l,getResponseHeaders as m,getResponseHeader as y,setResponseHeader as h,appendResponseHeader as b,removeResponseHeader as q,getRequestWebStream as S}from"h3";import{getContext as x}from"unctx";import{AsyncLocalStorage as $}from"node:async_hooks";function T(e){let n;const s=u(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(s,{...r,body:e.node.req.body}):new Request(s,{...r,get body(){return n||(n=E(e),n)}})}function C(e){return e.web??={request:T(e),url:u(e)},e.web.request}function v(){return k()}const a=Symbol("$HTTPEvent");function w(e){return typeof e=="object"&&(e instanceof o||e?.[a]instanceof o||e?.__is_event__===!0)}function t(e){return function(...n){let s=n[0];if(w(s))n[0]=s instanceof o||s.__is_event__?s:s[a];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(s=v(),!s)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");n.unshift(s)}return e(...n)}}const u=t(l),L=t(R),U=t(i),I=t(d),N=t(g),B=t(m),F=t(y),M=t(h),O=t(b),z=t(c),D=t(f),G=t(H),J=t(p),E=t(S),K=t(q),Q=t(C);function _(){return x("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:$})}function k(){return _().use().event}export{z as a,U as b,J as c,Q as d,L as e,I as f,D as g,N as h,F as i,M as j,O as k,B as l,K as r,G as s};
